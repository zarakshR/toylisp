Fix double-free bug when children have errors

Add consts and static wherever possible
